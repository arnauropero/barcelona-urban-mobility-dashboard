<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Barcelona Urban Mobility Dashboard</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            background: white;
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        h1 {
            color: #2d3748;
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1em;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
            transition: transform 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-title {
            font-size: 1.3em;
            color: #2d3748;
            margin-bottom: 20px;
            font-weight: 600;
        }

        .weather-display {
            display: flex;
            align-items: center;
            justify-content: space-around;
        }

        .weather-main {
            text-align: center;
        }

        .temperature {
            font-size: 3em;
            font-weight: 700;
            color: #667eea;
        }

        .weather-description {
            color: #718096;
            font-size: 1.1em;
            margin-top: 5px;
        }

        .weather-details {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }

        .detail-item {
            background: #f7fafc;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
        }

        .detail-label {
            color: #718096;
            font-size: 0.9em;
        }

        .detail-value {
            color: #2d3748;
            font-size: 1.2em;
            font-weight: 600;
        }

        .air-quality {
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .aqi-good {
            background: #48bb78;
            color: white;
        }

        .aqi-moderate {
            background: #ed8936;
            color: white;
        }

        .aqi-poor {
            background: #f56565;
            color: white;
        }

        .aqi-value {
            font-size: 2.5em;
            font-weight: 700;
        }

        .aqi-label {
            font-size: 1.1em;
            margin-top: 5px;
        }

        #map {
            height: 400px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .transport-calculator {
            background: #f7fafc;
            padding: 20px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .transport-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .transport-btn {
            background: white;
            border: 2px solid #e2e8f0;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .transport-btn:hover {
            border-color: #667eea;
            background: #667eea;
            color: white;
        }

        .transport-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }

        .co2-result {
            margin-top: 20px;
            padding: 15px;
            background: white;
            border-radius: 10px;
            text-align: center;
        }

        .co2-value {
            font-size: 2em;
            font-weight: 700;
            color: #667eea;
        }

        .loading {
            text-align: center;
            padding: 40px;
            color: #718096;
        }

        .error {
            background: #fed7d7;
            color: #c53030;
            padding: 15px;
            border-radius: 10px;
            margin-top: 15px;
        }

        .forecast-container {
            display: flex;
            gap: 15px;
            overflow-x: auto;
            padding: 10px 0;
        }

        .forecast-item {
            min-width: 120px;
            background: #f7fafc;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        .forecast-time {
            color: #718096;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .forecast-temp {
            color: #2d3748;
            font-size: 1.5em;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8em;
            }
            
            .dashboard {
                grid-template-columns: 1fr;
            }
            
            .temperature {
                font-size: 2.5em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üèôÔ∏è Barcelona Urban Mobility Dashboard</h1>
            <p class="subtitle">Real-time data for sustainable urban transportation | Smart Cities UAB Project</p>
        </header>

        <div class="dashboard">
            <!-- Weather Card -->
            <div class="card">
                <h2 class="card-title">üå§Ô∏è Current Weather</h2>
                <div id="weather-content">
                    <div class="loading">Loading weather data...</div>
                </div>
            </div>

            <!-- Air Quality Card -->
            <div class="card">
                <h2 class="card-title">üå¨Ô∏è Air Quality Index</h2>
                <div id="air-quality-content">
                    <div class="loading">Loading air quality data...</div>
                </div>
            </div>

            <!-- Map Card -->
            <div class="card">
                <h2 class="card-title">üó∫Ô∏è Barcelona Mobility Map</h2>
                <div id="map"></div>
            </div>

            <!-- CO2 Calculator Card -->
            <div class="card">
                <h2 class="card-title">üå± CO2 Emissions Calculator</h2>
                <div class="transport-calculator">
                    <p>Select your transport mode for a 5km journey:</p>
                    <div class="transport-options">
                        <button class="transport-btn" data-co2="0" onclick="calculateCO2(this, 'Walking/Cycling')">
                            üö∂ Walking/üö¥ Cycling
                        </button>
                        <button class="transport-btn" data-co2="50" onclick="calculateCO2(this, 'Metro/Bus')">
                            üöá Metro/Bus
                        </button>
                        <button class="transport-btn" data-co2="80" onclick="calculateCO2(this, 'Electric Car')">
                            üîå Electric Car
                        </button>
                        <button class="transport-btn" data-co2="150" onclick="calculateCO2(this, 'Petrol Car')">
                            üöó Petrol Car
                        </button>
                    </div>
                    <div id="co2-result" class="co2-result" style="display: none;">
                        <div class="co2-value">0g CO2</div>
                        <p id="co2-message"></p>
                    </div>
                </div>
            </div>

            <!-- Forecast Card -->
            <div class="card" style="grid-column: span 2;">
                <h2 class="card-title">üìä 24-Hour Weather Forecast</h2>
                <div id="forecast-content">
                    <div class="loading">Loading forecast data...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // OpenWeatherMap API Key (free tier)
        const API_KEY = '90289fcebcd99a48ce648eaaac27dade';
        const BARCELONA_LAT = 41.3851;
        const BARCELONA_LON = 2.1734;

        // Initialize map
        let map;
        function initMap() {
            map = L.map('map').setView([BARCELONA_LAT, BARCELONA_LON], 13);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '¬© OpenStreetMap contributors'
            }).addTo(map);

            // Add markers for key locations
            const locations = [
                { name: "Sagrada Familia", lat: 41.4036, lon: 2.1744, icon: "üèõÔ∏è" },
                { name: "Park G√ºell", lat: 41.4145, lon: 2.1527, icon: "üå≥" },
                { name: "Camp Nou", lat: 41.3809, lon: 2.1228, icon: "‚öΩ" },
                { name: "Barceloneta Beach", lat: 41.3809, lon: 2.1896, icon: "üèñÔ∏è" },
                { name: "UAB Campus", lat: 41.5002, lon: 2.1096, icon: "üéì" }
            ];

            locations.forEach(loc => {
                L.marker([loc.lat, loc.lon])
                    .bindPopup(`<strong>${loc.icon} ${loc.name}</strong><br>Smart City Point`)
                    .addTo(map);
            });
        }

        // Fetch weather data
        async function fetchWeather() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/weather?lat=${BARCELONA_LAT}&lon=${BARCELONA_LON}&appid=${API_KEY}&units=metric`
                );
                const data = await response.json();
                displayWeather(data);
            } catch (error) {
                document.getElementById('weather-content').innerHTML = 
                    '<div class="error">Failed to load weather data. Please try again later.</div>';
            }
        }

        // Display weather data
        function displayWeather(data) {
            const weatherHTML = `
                <div class="weather-display">
                    <div class="weather-main">
                        <div class="temperature">${Math.round(data.main.temp)}¬∞C</div>
                        <div class="weather-description">${data.weather[0].description}</div>
                    </div>
                </div>
                <div class="weather-details">
                    <div class="detail-item">
                        <div class="detail-label">Feels Like</div>
                        <div class="detail-value">${Math.round(data.main.feels_like)}¬∞C</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Humidity</div>
                        <div class="detail-value">${data.main.humidity}%</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Wind Speed</div>
                        <div class="detail-value">${data.wind.speed} m/s</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">Pressure</div>
                        <div class="detail-value">${data.main.pressure} hPa</div>
                    </div>
                </div>
            `;
            document.getElementById('weather-content').innerHTML = weatherHTML;
        }

        // Fetch air quality data
        async function fetchAirQuality() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/air_pollution?lat=${BARCELONA_LAT}&lon=${BARCELONA_LON}&appid=${API_KEY}`
                );
                const data = await response.json();
                displayAirQuality(data);
            } catch (error) {
                document.getElementById('air-quality-content').innerHTML = 
                    '<div class="error">Failed to load air quality data. Please try again later.</div>';
            }
        }

        // Display air quality data
        function displayAirQuality(data) {
            const aqi = data.list[0].main.aqi;
            const aqiLevels = ['', 'Good', 'Fair', 'Moderate', 'Poor', 'Very Poor'];
            const aqiClasses = ['', 'aqi-good', 'aqi-good', 'aqi-moderate', 'aqi-poor', 'aqi-poor'];
            
            const aqiHTML = `
                <div class="air-quality ${aqiClasses[aqi]}">
                    <div class="aqi-value">AQI: ${aqi}</div>
                    <div class="aqi-label">${aqiLevels[aqi]}</div>
                    <p style="margin-top: 10px; font-size: 0.9em;">
                        ${aqi <= 2 ? '‚úÖ Perfect for outdoor activities!' : 
                          aqi <= 3 ? '‚ö†Ô∏è Sensitive groups should limit prolonged outdoor exertion' : 
                          '‚ùå Everyone should limit outdoor activities'}
                    </p>
                </div>
                <div class="weather-details" style="margin-top: 20px;">
                    <div class="detail-item">
                        <div class="detail-label">PM2.5</div>
                        <div class="detail-value">${data.list[0].components.pm2_5} Œºg/m¬≥</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">PM10</div>
                        <div class="detail-value">${data.list[0].components.pm10} Œºg/m¬≥</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">NO‚ÇÇ</div>
                        <div class="detail-value">${data.list[0].components.no2} Œºg/m¬≥</div>
                    </div>
                    <div class="detail-item">
                        <div class="detail-label">O‚ÇÉ</div>
                        <div class="detail-value">${data.list[0].components.o3} Œºg/m¬≥</div>
                    </div>
                </div>
            `;
            document.getElementById('air-quality-content').innerHTML = aqiHTML;
        }

        // Fetch forecast data
        async function fetchForecast() {
            try {
                const response = await fetch(
                    `https://api.openweathermap.org/data/2.5/forecast?lat=${BARCELONA_LAT}&lon=${BARCELONA_LON}&appid=${API_KEY}&units=metric&cnt=8`
                );
                const data = await response.json();
                displayForecast(data);
            } catch (error) {
                document.getElementById('forecast-content').innerHTML = 
                    '<div class="error">Failed to load forecast data. Please try again later.</div>';
            }
        }

        // Display forecast data
        function displayForecast(data) {
            let forecastHTML = '<div class="forecast-container">';
            
            data.list.forEach(item => {
                const date = new Date(item.dt * 1000);
                const time = date.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
                
                forecastHTML += `
                    <div class="forecast-item">
                        <div class="forecast-time">${time}</div>
                        <div class="forecast-temp">${Math.round(item.main.temp)}¬∞C</div>
                        <div style="font-size: 0.9em; color: #718096;">${item.weather[0].main}</div>
                    </div>
                `;
            });
            
            forecastHTML += '</div>';
            document.getElementById('forecast-content').innerHTML = forecastHTML;
        }

        // CO2 Calculator
        function calculateCO2(button, transport) {
            // Remove active class from all buttons
            document.querySelectorAll('.transport-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Add active class to clicked button
            button.classList.add('active');
            
            const co2Value = parseInt(button.getAttribute('data-co2'));
            const resultDiv = document.getElementById('co2-result');
            const co2Message = document.getElementById('co2-message');
            
            resultDiv.style.display = 'block';
            document.querySelector('.co2-value').textContent = `${co2Value}g CO2`;
            
            let message = '';
            if (co2Value === 0) {
                message = 'üåü Excellent choice! Zero emissions and great for your health!';
            } else if (co2Value <= 50) {
                message = '‚úÖ Great choice! Public transport is sustainable and efficient.';
            } else if (co2Value <= 80) {
                message = '‚ö° Good option! Electric vehicles reduce urban pollution.';
            } else {
                message = 'üí≠ Consider greener alternatives when possible!';
            }
            
            co2Message.textContent = message;
        }

        // Initialize everything
        window.onload = function() {
            initMap();
            fetchWeather();
            fetchAirQuality();
            fetchForecast();
            
            // Refresh data every 5 minutes
            setInterval(() => {
                fetchWeather();
                fetchAirQuality();
                fetchForecast();
            }, 300000);
        };
    </script>
</body>
</html>
